{
    "id": 236307716,
    "contestId": 570,
    "creationTimeSeconds": 1702026073,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 570,
        "index": "E",
        "name": "Pig and Palindromes",
        "type": "PROGRAMMING",
        "points": 2500.0,
        "rating": 2300,
        "tags": [
            "combinatorics",
            "dp"
        ]
    },
    "author": {
        "contestId": 570,
        "members": [
            {
                "handle": "CLC__Haaland"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1439483400
    },
    "programmingLanguage": "GNU C++20 (64)",
    "verdict": "WRONG_ANSWER",
    "testset": "TESTS",
    "passedTestCount": 7,
    "timeConsumedMillis": 15,
    "memoryConsumedBytes": 36352000,
    "source": "#include <bits/stdc++.h>\r\n\r\nusing namespace std;\r\n\r\n#define ll long long\r\n#define rep(i,m,n) for(int i=m; i<=n; i++)\r\n#define reb(i,m,n) for(int i=m; i>=n; i--)\r\n#define iter(id, v) for (auto id : v)\r\n#define ii pair<ll,ll>\r\n#define fs first\r\n#define se second\r\n#define pb push_back\r\n#define SZ(v) (int)v.size()\r\n#define ALL(v) v.begin(), v.end()\r\n#define bit(msk, i) ((msk >> i) & 1)\r\n#define file(name) freopen(name\".inp\", \"r\", stdin); freopen(name\".out\", \"w\", stdout);\r\n\r\ntemplate<typename A, typename B> ostream& operator<<(ostream& out, const pair<A, B> &v) {\r\n    out << \"(\" << v.fs << \",\" << v.se << \") \";\r\n    return out;\r\n}\r\n\r\n#ifndef ONLINE_JUDGE\r\n#include \"debug.h\"\r\n#else\r\n#define deb(...) 23\r\n#define ____\r\n#endif\r\n\r\nmt19937_64 rd(chrono :: steady_clock :: now().time_since_epoch().count());\r\nll Rand(ll l, ll r) {\r\n    return uniform_int_distribution<ll> (l, r)(rd);\r\n}\r\n\r\nconst ll N = 150 + 7;\r\nll Mod = 1e9 + 7;\r\nconst ll szBL = 650;\r\nconst ll INF = 1e18;\r\nconst ll B = 137;\r\n\r\nll n, m;\r\nstring s;\r\nchar a[N][N];\r\n\r\nnamespace sub1 {\r\n\r\n    bool check(string &cur) {\r\n        rep(i, 0, m + n - 3)\r\n        if(cur[i] == '#')\r\n            return 0;\r\n        rep(i, 0, SZ(cur) / 2 - 1) {\r\n            if(cur[i] != cur[SZ(cur) - i - 1])\r\n                return 0;\r\n        }\r\n        ll ptr = 0;\r\n        rep(i, 0, SZ(cur) - 1) {\r\n            if(ptr == SZ(s))\r\n                return 1;\r\n            if(cur[i] == s[ptr])\r\n                ++ptr;\r\n        }\r\n        if(ptr == SZ(s))\r\n            return 1;\r\n        return 0;\r\n    }\r\n\r\n    bool outside(ll i, ll j) {\r\n        if(i == n + 1 || j == m + 1)\r\n            return 1;\r\n        return 0;\r\n    }\r\n\r\n    void chloe_solution() {\r\n        ll res = 0;\r\n        rep(msk, 0, (1 << m + n - 2) - 1) {\r\n            pair<int, int> cur = {1, 1};\r\n            string str = \"\";\r\n            str += a[1][1];\r\n            bool ok = 1;\r\n            rep(i, 0, m + n - 3) {\r\n                //                cout << cur.fs <<\" \"<<cur.se <<\"\\n\";\r\n                if(outside(cur.fs, cur.se)) {\r\n                    ok = 0;\r\n                    break;\r\n                }\r\n                if(bit(msk, i)) {\r\n                    cur.fs++;\r\n                    str += a[cur.fs][cur.se];\r\n                } else {\r\n                    cur.se++;\r\n                    str += a[cur.fs][cur.se];\r\n                }\r\n            }\r\n//            cout << ok<<\" \"<<str <<\"\\n\";\r\n            if(ok && check(str))\r\n                res++;\r\n//            return;\r\n        }\r\n        cout << res % Mod << \"\\n\";\r\n    }\r\n}\r\n\r\nnamespace sub2 {\r\nll dp[N][N];\r\nvoid chloe_solution() {\r\n    if(SZ(s) > m + n - 1) {\r\n        cout << 0 << \"\\n\";\r\n        return;\r\n    }\r\n    dp[1][1] = 1;\r\n    rep(i, 1, n) {\r\n        rep(j, 1, m) {\r\n            if(a[i][j] == '#')\r\n                continue;\r\n            if(i - 1 > 0 && a[i - 1][j] != '#') {\r\n                (dp[i][j] += dp[i - 1][j]) %= Mod;\r\n            }\r\n            if(j - 1 > 0 && a[i][j - 1] != '#') {\r\n                (dp[i][j] += dp[i][j - 1]) %= Mod;\r\n            }\r\n        }\r\n    }\r\n    cout << dp[n][m] << \"\\n\";\r\n}\r\n}\r\nnamespace sub3 {\r\n\r\n    const ll N2 = 30 + 5;\r\n    ll dp[N2][N2][N2][N2];\r\n\r\n    void chloe_solution() {\r\n        dp[1][1][n][m] = (a[1][1] != '#' && a[n][m] != '#' && a[1][1] == a[n][m]);\r\n        rep(i, 1, n)\r\n        rep(j, 1, m)\r\n        reb(k, n, 1) {\r\n            int p = m - (i + j - 2 - (n - k));\r\n            if(p < 1 || p > m)\r\n                continue;\r\n//            deb (i, j, k, p, dp[i][j][k][p]);\r\n            rep(msk, 0, (1 << 4) - 1) {\r\n                if(__builtin_popcount(msk) != 2)\r\n                    continue;\r\n                vector<int> v = {i, j, k, p};\r\n                int ok = 0;\r\n                rep(t, 0, 3) {\r\n                    if(bit(msk, t)) {\r\n                        if(t <= 1) {\r\n                            v[t]++;\r\n                            ok++;\r\n                        } else {\r\n                            v[t]--;\r\n                            ok--;\r\n                        }\r\n                    }\r\n                }\r\n                if(ok == 0 && a[v[0]][v[1]] == a[v[2]][v[3]] && a[v[0]][v[1]] != '#' && a[v[2]][v[3]] != '#') {\r\n                    (dp[v[0]][v[1]][v[2]][v[3]] += dp[i][j][k][p]) %= Mod;\r\n//                    cout << v[0] <<\" \"<<v[1] <<\" \"<<v[2]<<\" \"<<v[3] <<\" ::\"<<a[1][3]<<\" \"<<a[2][3]<<\": \" <<dp[v[0]][v[1]][v[2]][v[3]] <<\"\\n\";\r\n                }\r\n            }\r\n        }\r\n        ll res = 0;\r\n        if ((m+n-1)%2 == 0) {\r\n            rep(i, 1, n)\r\n            rep(j, 1, m)\r\n            rep(k,1,m) {\r\n                int p = m - (i + j - 2 - (n - k));\r\n                if(p < 1 || p > m)\r\n                    continue;\r\n                if (i+j-2 == n-k+m-p && i+j-1 == (m+n-1)/2 && i<=k &&j<=p) {\r\n//                    deb(i,j,k,p,dp[i][j][k][p], \"hi\");\r\n                    (res += dp[i][j][k][p])%=Mod;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            rep(i, 1, n)\r\n            rep(j, 1, m) {\r\n                if(i + j - 2 == n - i + m - j && i+j-1 == (m+n-1)/2+1) {\r\n                    (res += dp[i][j][i][j]) %= Mod;\r\n                }\r\n            }\r\n        }\r\n        cout << res << \"\\n\";\r\n    }\r\n}\r\n\r\nnamespace sub4 {\r\n\r\n    const ll N2 = 30 + 5;\r\n    ll dp[N2][N2][N2][N2][2];\r\n\r\n    void chloe_solution() {\r\n        int ok = (a[1][1] != '#' && a[n][m] != '#' && a[1][1] == a[n][m] && a[n][m] == s[0]);\r\n        dp[1][1][n][m][ok] = (a[1][1] != '#' && a[n][m] != '#' && a[1][1] == a[n][m]);\r\n        rep(i, 1, n)\r\n        rep(j, 1, m)\r\n        reb(k, n, 1)\r\n        rep(t, 0, 1) {\r\n            int p = m - (i + j - 2 - (n - k));\r\n            if(p < 1 || p > m)\r\n                continue;\r\n    //            deb (i, j, k, p, dp[i][j][k][p]);\r\n            rep(msk, 0, (1 << 4) - 1) {\r\n                if(__builtin_popcount(msk) != 2)\r\n                    continue;\r\n                vector<int> v = {i, j, k, p};\r\n                int ok = 0;\r\n                rep(t, 0, 3) {\r\n                    if(bit(msk, t)) {\r\n                        if(t <= 1) {\r\n                            v[t]++;\r\n                            ok++;\r\n                        } else {\r\n                            v[t]--;\r\n                            ok--;\r\n                        }\r\n                    }\r\n                }\r\n                if(ok == 0 && a[v[0]][v[1]] == a[v[2]][v[3]] && a[v[0]][v[1]] != '#' && a[v[2]][v[3]] != '#') {\r\n                    int nt = max(t, 1 * (a[v[0]][v[1]] == s[0] || a[v[2]][v[3]] == s[0]));\r\n                    (dp[v[0]][v[1]][v[2]][v[3]][nt] += dp[i][j][k][p][t]) %= Mod;\r\n                }\r\n            }\r\n        }\r\n        ll res = 0;\r\n        if ((m+n-1)%2 == 0) {\r\n            rep(i, 1, n)\r\n            rep(j, 1, m)\r\n            rep(k,1,m) {\r\n                int p = m - (i + j - 2 - (n - k));\r\n                if(p < 1 || p > m)\r\n                    continue;\r\n                if (i+j-2 == n-k+m-p && i+j-1 == (m+n-1)/2 && i<=k &&j<=p) {\r\n                    (res += dp[i][j][k][p][1])%=Mod;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            rep(i, 1, n)\r\n            rep(j, 1, m) {\r\n                if(i + j - 2 == n - i + m - j && i+j-1 == (m+n-1)/2+1) {\r\n                    (res += dp[i][j][i][j][1]) %= Mod;\r\n                }\r\n            }\r\n        }\r\n        cout << res <<\"\\n\";\r\n    }\r\n}\r\n\r\nbool checksub2() {\r\n    if(n > 30 || m > 30)\r\n        return 0;\r\n    char delta = '.';\r\n    rep(i, 1, n)\r\n    rep(j, 1, m) {\r\n        if(a[i][j] != '#') {\r\n            if(delta == '.')\r\n                delta = a[i][j];\r\n            else if(a[i][j] != delta)\r\n                return 0;\r\n        }\r\n    }\r\n    rep (i, 1, SZ(s) - 1) if (s[i] != s[i-1]) return 0;\r\n    return (s[0] == delta);\r\n}\r\n\r\nbool checksub3() {\r\n    if(n > 30 || m > 30 || SZ(s) > 1)\r\n        return 0;\r\n    if(s[0] != a[1][1])\r\n        return 0;\r\n    return 1;\r\n}\r\n\r\nbool checksub4() {\r\n    if(n > 3 || m > 30 || SZ(s) > 1)\r\n        return 0;\r\n    return 1;\r\n}\r\n\r\nvoid chloe_solution() {\r\n    cin >> n >> m;\r\n    Mod = 1e9 + 7;\r\n//    cin >> s;\r\n    rep(i, 1, n) {\r\n        string st;\r\n        cin >> st;\r\n        rep(j, 1, m)  {\r\n            a[i][j] = st[j - 1];\r\n        }\r\n    }\r\n//    if(n <= 10 && m <= 10)\r\n//        sub1 :: chloe_solution();\r\n//    else if(checksub2())\r\n//        sub2 :: chloe_solution();\r\n//    else if(checksub3())\r\n        sub3 :: chloe_solution();\r\n//    else\r\n//        sub4 :: chloe_solution();\r\n}\r\n\r\nint main() {\r\n//    file(\"c\");\r\n    ios_base::sync_with_stdio(false);\r\n    cin.tie(0);\r\n    cout.tie(0);\r\n    ll num_Test = 1;\r\n//    cin >> num_Test;\r\n    while(num_Test--)\r\n        chloe_solution();\r\n}\r\n/*\r\n4 4 100\r\na\r\naabc\r\nab#b\r\nacba\r\naaaa\r\n\r\n*/\r\n"
}