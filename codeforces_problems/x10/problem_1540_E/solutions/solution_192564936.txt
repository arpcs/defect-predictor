{
    "id": 192564936,
    "contestId": 1540,
    "creationTimeSeconds": 1675753036,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 1540,
        "index": "E",
        "name": "Tasty Dishes",
        "type": "PROGRAMMING",
        "points": 3500.0,
        "rating": 3500,
        "tags": [
            "math",
            "matrices"
        ]
    },
    "author": {
        "contestId": 1540,
        "members": [
            {
                "handle": "CyanSineSin"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1624635300
    },
    "programmingLanguage": "GNU C++14",
    "verdict": "RUNTIME_ERROR",
    "testset": "TESTS",
    "passedTestCount": 1,
    "timeConsumedMillis": 1778,
    "memoryConsumedBytes": 25395200,
    "source": "// LUOGU_RID: 101632024\n/*\r\n\u5148\u5047\u8bbebi\u4e00\u5f00\u59cb\u5168\u90e8>=0\r\n\u90a3\u4e48j\u5929\u4e4b\u540e\u5bf9\u524d\u9762\u7684\u6240\u6709\u70b9\u9020\u6210\u7684\u8d21\u732e\u53ef\u9884\u5904\u7406\u3002\r\n\u2026\u2026\u5b58\u5728<0\u6709\u70b9\u9ebb\u70e6\u4e0d\u8fc7\u7b49\u4e0b\uff0c\u6211\u5148\u522b\u6025\u3002\r\n\u7136\u540e\u641e\u4e2a\u524d\u7f00\u548c\u3002\r\n\u5c31\u53ef\u4ee5O(n)\u56de\u7b54\u4e86\u3002\r\n\r\n\u7136\u540e\u4fee\u6539\u53ea\u670920000\u6b21\u6709\u7528\u8fd9\u4e2a\u6709\u7528\u5417\uff0c\u770b\u8d77\u6765\u6ca1\u3002\r\n|ai|<=i\u5219ai>=-i\uff0c\u4e5f\u5c31\u662f\u53ea\u8981Si\u91cc\u9762\u6709\u4e00\u4e2a\u5927\u4e8e1\u7684\uff0c\u5b83\u9a6c\u4e0a\u5c31\u53ef\u4ee5\u5927\u4e8e1\u3002\r\n\u90a3\u6211\u4eec\u53ef\u4ee5\u627e\u4e00\u4e0b\u4ec0\u4e48\u65f6\u5019\u6240\u6709\u7684\u70b9>=0\u7684\u72b6\u6001\u5df2\u7ecf\u4e0d\u53d8\u4e86\uff0c\u7136\u540e\u63a5\u4e0b\u6765\u53ef\u4ee5\u4f7f\u7528\u9884\u5904\u7406\u7684\u503c\u8fdb\u884c\u56de\u7b54\u3002\r\n\u4e5f\u5c31\u662f\u6211\u4eec\u6210\u529f\u5c06k\u7f29\u5c0f\u5230\u4e86O(n)\u3002\r\n\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u5728\u6bcf\u6b21\u8be2\u95ee\u6765\u66b4\u529b\u8ba1\u7b97\u4ec0\u4e48\u65f6\u5019\u7ed3\u675f\uff0c\u800c\u4e14\u6211\u4eec\u8981\u8ba1\u7b97\u7ed3\u675f\u65f6\u7684\u503c\u7684\u3002\r\n\u7b49\u4e0b\uff0c\u524d\u9762\u90a3\u4e2a\u9884\u5904\u7406\u662f\u4e0d\u662fn^2k\u7684\r\n\uff01\uff01\uff01\uff01\uff01\r\n\u7b49\u4e0b\u6211\u8fd8\u8981\u679a\u4e3e\u662f\u54ea\u4e2a\u8282\u70b9\u9020\u6210\u7684\u8d21\u732e\r\nn^3k\u7684\uff01\r\n\u5988\u5988\u751f\u7684\u3002 \r\n\r\n\u4ec0\u4e48\u65f6\u5019\u7ed3\u675f\u6700\u591a\u53ea\u4f1a\u66f4\u65b0n\u6b21\uff0c\u6240\u4ee5\u4fee\u6539\u4e4b\u540e\u66b4\u529b\u66f4\u65b0\u5c31\u597d\u4e86\u3002\r\n\u7ed3\u675f\u7684\u65f6\u5019\u7684\u503c\u53ea\u66f4\u65b0n^2\u6b21\uff0c\u66b4\u529b\u66f4\u65b0\u5c31\u597d\u4e86\uff1f \u4e0d\u5bf9\u554a\uff0c\u66f4\u65b0\u4e00\u6b21\u662fn^3\u7684\u3002 \r\n\u90a3\u7ed3\u675f\u4e4b\u524d\u7684\u503c\u600e\u4e48\u7b97\u634f\u2026\u2026\u8fd9\u4e2a\u8bb0\u5f55\u4e0b\u6765\u5c31\u597d\u3002\r\n\u8bb0\u5f55\u4e0b\u6bcf\u4e2a\u8282\u70b9\u53d8\u6210>=0\u7684\u503c\u7684\u65f6\u523b\u3002\r\n\u7136\u540e\u7528\u8fd9\u4e2a\u52a0\u4e0a\u524d\u9762\u9884\u5904\u7406\u7684\u8868\u6765\u8ba1\u7b97\u4e00\u4e0b\u8d21\u732e\uff1f\r\n\u90a3\u73b0\u5728\u95ee\u9898\u5c31\u662f\u600e\u4e48\u9884\u5904\u7406\u8fd9\u4e2a\u8868\u634f\u3002\r\n\u8fd9\u4e2a\u8868\u7684\u5927\u5c0f\u5c31\u4e0d\u5bf9\u3002n^2k\u7684\u8868\u3002\r\n\u4e0d\u4f1a\u662f\u77e9\u9635\u4e58\u6cd5\u5427\u3002\r\n\u6bcf\u6b21\u8f6c\u79fb\u7684\u65b9\u7a0b\u786e\u5b9e\u53ef\u4ee5\u5217\u51fa\u4e00\u4e2a\u77e9\u9635\u3002\r\n\u7136\u540e\u9884\u5904\u7406\u5e42\u6b21\u3002\r\n\u6bcf\u6b21\u4e58\u4e00\u4e0b\u53ef\u662fn^3\u2026\u2026\r\n\u7136\u540e\u4e00\u4e2a\u5411\u91cf\u4e58\u4e00\u4e0b\u5c31\u662fn^2\u3002\r\nqn^2\u2026\u2026\r\n\u8fd8\u5e26\u4e2alog\u2026\u2026 \r\n\u54e6\u53ef\u4ee5\u5149\u901f\u5e42\uff0c\u7136\u540e\u5c31\u662fn^3sqrt(k)+qn^2\r\n\u66f4\u65b0\u7ed3\u675f\u4e86\u4e4b\u540e\u7684\u66f4\u65b0n^2*n^2\u3002\r\n\u54e6\u4e0d\u7528\u66f4\u65b0\u3002\u76f4\u63a5\u7b97\u5c31\u597d\u4e86\u3002\r\n\u751f\u6d3b\u5904\u5904\u662f\u74f6\u9888\u3002 \r\n\r\ntm\u600e\u4e48\u662f\u5173\u952e\u5b57\u554a \r\n\u4e00\u6b21\u8fc7\u6837\u4f8b\uff1f\uff1f\uff1f\uff1f\uff1f \r\n\u5df2\u7ecf\u5f00\u59cb\u5bb3\u6015\u4e86\u3002 \r\n\u4f60\u51fa\u5f97\u597d\uff0c\u4f60\u51fa\u5f97\u597d\u554a\u3002 \r\n\r\n36s\u627e\u4e0d\u5230\u5dee\u5f02/fn/fn/fn/fn/fn/fn/fn \r\n\r\n\u6709\u4e2ashaber\u5939\u4e86\u4e2an^3k\uff0c\u6211\u4e0d\u8bf4\u662f\u8c01\u3002 \r\n10s\u4e86\uff0c\u8036 \r\n7.5\u4e0d\u4f1a\u5361\u4e86 \r\n*/\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\nconst int mod=1e9+7;\r\nstruct cube\r\n{\r\n\tint num[301][301];\r\n}begining,eve[33],sum[33];\r\nint n,a[310],c,v,q,opa,opb,opc,op,tmpa[310],pmta[310];\r\nint head[310],to[90010],nxt[90010],cntot;\r\ninline void addedge(int one,int ano)\r\n{\r\n\tnxt[++cntot]=head[one];\r\n\tto[cntot]=ano;\r\n\thead[one]=cntot;\r\n}\r\ninline void tim(cube &one,cube &ano,cube &res)\r\n{\r\n\tfor(int i=1;i<=n;++i)\r\n\t{\r\n\t\tfor(int j=i;j<=n;++j)\tres.num[i][j]=0;\r\n\t}\r\n\tfor(int i=1;i<=n;++i)\r\n\t{\r\n\t\tfor(int k=i;k<=n;++k)\r\n\t\t{\r\n\t\t\tfor(int j=k;j<=n;++j)\tres.num[i][j]=(res.num[i][j]+(long long)one.num[i][k]*ano.num[k][j])%mod;\r\n\t\t}\r\n\t}\r\n}\r\nint tiim[310],alltim;\r\nbool posi[310];\r\nqueue<int> que;\r\ninline void reb()\r\n{\r\n\tfor(int i=1;i<=n;++i)\r\n\t{\r\n\t\tif(a[i]>=1)\r\n\t\t{\r\n\t\t\tposi[i]=1;\r\n\t\t\ttiim[i]=0;\r\n\t\t\tque.push(i);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tposi[i]=0;\r\n\t\t\ttiim[i]=1145141;\r\n\t\t}\r\n\t}\r\n\twhile(!que.empty())\r\n\t{\r\n\t\tint x=que.front();\r\n\t\tque.pop();\r\n\t\tfor(int i=head[x];i;i=nxt[i])\r\n\t\t{\r\n\t\t\tint y=to[i];\r\n\t\t\tif(!posi[y])\r\n\t\t\t{\r\n\t\t\t\tposi[y]=1;\r\n\t\t\t\ttiim[y]=tiim[x]+1;\r\n\t\t\t\tque.push(y);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\talltim=0;\r\n\tfor(int i=1;i<=n;++i)\r\n\t{\r\n\t\tif(posi[i])\talltim=max(alltim,tiim[i]);\r\n\t}\r\n}\r\nint main()\r\n{\r\n//\tfreopen(\"dag.in\",\"r\",stdin);\r\n//\tfreopen(\"dag.out\",\"w\",stdout);\r\n//\tfreopen(\"ex_dag1.in\",\"r\",stdin);\r\n//\tfreopen(\"me.out\",\"w\",stdout);\r\n\tscanf(\"%d\",&n);\r\n\tfor(int i=1;i<=n;++i)\tscanf(\"%d\",&a[i]);\r\n\tfor(int i=1;i<=n;++i)\r\n\t{\r\n\t\tscanf(\"%d\",&c);\r\n\t\tfor(int j=1;j<=c;++j)\r\n\t\t{\r\n\t\t\tscanf(\"%d\",&v);\r\n\t\t\taddedge(v,i);\r\n\t\t\tbegining.num[i][v]=v;\r\n\t\t}\r\n\t\tbegining.num[i][i]=i;\r\n\t\teve[0].num[i][i]=sum[0].num[i][i]=1;\r\n\t}\r\n\tfor(int i=1;i<=32;++i)\ttim(eve[i-1],begining,eve[i]);\r\n\tfor(int i=1;i<=32;++i)\ttim(sum[i-1],eve[32],sum[i]);\r\n\treb();\r\n\tscanf(\"%d\",&q);\r\n\tfor(int i=1;i<=q;++i)\r\n\t{\r\n\t\tscanf(\"%d %d %d\",&op,&opa,&opb);\r\n\t\tif(op==1)\r\n\t\t{\r\n\t\t\tscanf(\"%d\",&opc);\r\n\t\t\tfor(int j=1;j<=n;++j)\ttmpa[j]=a[j];\r\n\t\t\tint ans=0;\r\n\t\t\tif(opa<=alltim)\r\n\t\t\t{\r\n\t\t\t\tfor(int k=opb;k<=n;++k)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(tiim[k]<=opa)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(k<=opc)\ttmpa[k]=((long long)a[k]*eve[opa-tiim[k]].num[k][k])%mod;\r\n\t\t\t\t\t\tfor(int j=opb;j<k&&j<=opc;++j)\ttmpa[j]=(tmpa[j]+(long long)a[k]*eve[opa-tiim[k]].num[j][k])%mod;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor(int j=opb;j<=opc;++j)\tans=(ans+tmpa[j])%mod;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor(int k=opb;k<=n;++k)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(tiim[k]<=alltim)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttmpa[k]=((long long)a[k]*eve[alltim-tiim[k]].num[k][k])%mod;\r\n\t\t\t\t\t\tfor(int j=opb;j<k;++j)\ttmpa[j]=(tmpa[j]+(long long)a[k]*eve[alltim-tiim[k]].num[j][k])%mod;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcube ret=eve[(opa-alltim)%32];\r\n\t\t\t\tfor(int j=opb;j<=n;++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(posi[j])\tpmta[j]=0;\r\n\t\t\t\t\telse\tpmta[j]=tmpa[j];\r\n\t\t\t\t}\r\n\t\t\t\tfor(int k=opb;k<=n;++k)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(posi[k])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(int j=opb;j<=k;++j)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpmta[j]=(pmta[j]+(long long)tmpa[k]*ret.num[j][k])%mod;\r\n//\t\t\t\t\t\t\tprintf(\" %d %d\\n\",tmpa[k],ret.num[j][k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tret=sum[(opa-alltim)/32];\r\n\t\t\t\tfor(int j=opb;j<=n;++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(posi[j])\ttmpa[j]=0;\r\n\t\t\t\t\telse\ttmpa[j]=pmta[j];\r\n\t\t\t\t}\r\n\t\t\t\tfor(int k=opb;k<=n;++k)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(posi[k])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(int j=opb;j<=k&&j<=opc;++j)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttmpa[j]=(tmpa[j]+(long long)pmta[k]*ret.num[j][k])%mod;\r\n//\t\t\t\t\t\t\tprintf(\" %d %d\\n\",tmpa[k],ret.num[j][k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor(int j=opb;j<=opc;++j)\tans=(ans+tmpa[j])%mod;\r\n\t\t\t}\r\n\t\t\tprintf(\"%d\\n\",(ans+mod)%mod);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ta[opa]+=opb;\r\n\t\t\tif(a[opa]>=1&&a[opa]-opb<1)\treb(); \r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n}"
}