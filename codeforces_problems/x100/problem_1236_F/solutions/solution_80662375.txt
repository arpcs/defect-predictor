{
    "id": 80662375,
    "contestId": 1236,
    "creationTimeSeconds": 1589871403,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 1236,
        "index": "F",
        "name": "Alice and the Cactus",
        "type": "PROGRAMMING",
        "points": 2500.0,
        "rating": 3000,
        "tags": [
            "dfs and similar",
            "graphs",
            "math",
            "probabilities"
        ]
    },
    "author": {
        "contestId": 1236,
        "members": [
            {
                "handle": "00ffcc"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1571319300
    },
    "programmingLanguage": "GNU C++11",
    "verdict": "OK",
    "testset": "TESTS",
    "passedTestCount": 122,
    "timeConsumedMillis": 2386,
    "memoryConsumedBytes": 78540800,
    "source": "#include<bits/stdc++.h>\r\nusing namespace std;\r\ntemplate<typename T>inline void read(T& t)\r\n{T f=1;char ch=getchar();t=0;\r\nwhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\r\nwhile(ch>='0'&&ch<='9')t=t*10+ch-'0',ch=getchar();t*=f;}\r\ntemplate <typename T,typename... Args>\r\ninline void read(T& t, Args&... args)\r\n{read(t);read(args...);}\r\nconst long long p=1e9+7;\r\nlong long n,m;\r\nint head[500005],ne[1000005],to[1000005],total=1;\r\ninline void add(int a,int b)\r\n{\r\n\ttotal++;\r\n\tto[total]=b;\r\n\tne[total]=head[a];\r\n\thead[a]=total;\r\n}\r\nint fa[500005],deep[500005];\r\nint fa_edge[500005];\r\nint cnt;\r\nvector<int> var[1000005],edg[1000005];\r\nint deg[1000005];\r\npair<int,int> edge[1000005];\r\nlong long sum1;\r\nlong long inv_sum[1000005];//\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u06bb\ufffd\ufffd\u0134\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\ufffd\u05ae\ufffd\ufffd \r\nlong long edg_inv_sum[1000005];//\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u03f5\u013b\ufffd\ufffd\u0134\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\ufffd\u05ae\ufffd\ufffd\r\nint belong[1000005];//\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u06b5\u013b\ufffd\ufffd\u0131\ufffd\ufffd \r\n#define turn(X) (((X)>>1))\r\n#define deb if(0)\r\nint dfs(int now)\r\n{\r\ndeb\tprintf(\"now=%d,fa=%d fa_edge=%d\\n\",now,fa[now],fa_edge[now]);\r\n\tdeep[now]=deep[fa[now]]+1;\r\n\tfor(int i=head[now];i;i=ne[i])\r\n\t\tif(to[i]!=fa[now])\r\n\t\t{\r\n\t\t\tif(deep[to[i]])\r\n\t\t\t{\r\n\t\t\t\tif(deep[to[i]]<deep[now])\r\n\t\t\t\t{\r\n\t\t\t\t\tcnt++;\r\n\t\t\t\t\tfor(int j=now;j!=to[i];j=fa[j])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar[cnt].push_back(j);\r\n\t\t\t\t\t\tedg[cnt].push_back(turn(fa_edge[j]));\r\n\t\t\t\t\t\tbelong[turn(fa_edge[j])]=cnt;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar[cnt].push_back(to[i]);\r\n\t\t\t\t\tedg[cnt].push_back(turn(i));\r\n\t\t\t\t\tbelong[turn(i)]=cnt; \r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfa_edge[to[i]]=i;\r\n\t\t\t\tfa[to[i]]=now;\r\n\t\t\t\tdfs(to[i]);\r\n\t\t\t}\r\n\t\t}\r\n}\r\ninline long long power(register long long x,register long long k)\r\n{\r\n\tregister long long re=1;\r\n\tfor(;k;k>>=1,x=x*x%p)if(k&1)re=re*x%p;\r\n\treturn re;\r\n}\r\ninline long long inv2(long long x)\r\n{\r\n\treturn power(2,x*(p-2)%(p-1));\r\n}\r\nlong long E()\r\n{\r\n\tlong long ans=0;\r\n\tfor(int i=1;i<=cnt;i++)\r\n\t\tans=(ans+inv2(var[i].size()))%p;//ans:E(c)(\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd1/(2^size)\ufffd\u0138\ufffd\ufffd\u02bb\ufffd\ufffd\ufffd\ufffd)\r\n\tans=(n*inv2(1)%p-m*inv2(2)%p+ans+p)%p;//n/2:E(a)(\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd1/2\ufffd\u0138\ufffd\ufffd\u02bb\ufffd\ufffd\ufffd\ufffd ) m/4:E(b)(\u00ff\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd1/4\ufffd\u0138\ufffd\ufffd\u02bb\ufffd\ufffd\ufffd\ufffd )\r\ndeb\tprintf(\"E=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long aa()\r\n{\r\n\tlong long ans=n*(n+1)%p*inv2(2)%p;\r\ndeb\tprintf(\"aa=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long bb()//\u00f6\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u07e3\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u01f6\ufffd\ufffd\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\u02b5\u013a\ufffd \r\n{\r\n\tlong long ans=0;\r\n\tfor(int i=1;i<=m;i++)\r\n\t{\r\n\t\tans=(ans+inv2(3)*(deg[edge[i].first]+deg[edge[i].second]-2)%p)%p;//\ufffd\ufffddeg_st+deg_ed-2\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u05ae\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u03aa1/8\r\n\t\tans=(ans+inv2(4)*(m-deg[edge[i].first]-deg[edge[i].second]+1)%p)%p;//\ufffd\ufffdm-deg_st-deg_ed+1\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u05ae\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u03aa1/16\r\n\t\tans=(ans+inv2(2))%p;//\ufffd\u053c\ufffd \r\n\t}\r\ndeb\tprintf(\"bb=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long cc()//\u00f6\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u01f6\ufffd\ufffd\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\u02b5\u013a\ufffd \r\n{\r\n\tlong long ans=0,tp;\r\n\tfor(int i=1;i<=cnt;i++)\r\n\t{\r\n\t\ttp=inv2(var[i].size());\r\n\t\tlong long sm=sum1-tp;\r\n\t\tfor(auto j:var[i])\r\n\t\t{\r\n\t\t\tans=(ans+(inv_sum[j]-tp+p)%p*tp%p*2%p)%p;//\ufffd\ubd71\u01f0\ufffd\ufffd\ufffd\u043d\ufffd\ufffd\u013b\ufffd\ufffd\ufffd\u00f6\ufffd\u067d\ufffd\ufffd\u38ec\ufffd\ufffd\ufffd\ufffd\u04bb\ufffd\ufffd\u0461\ufffd\ufffd\ufffd\u0538\ufffd\ufffd\ufffd*2\r\n\t\t\tsm=(sm-(inv_sum[j]-tp)+p)%p;//\ufffd\ufffd\ufffd\ufffd\u00fb\ufffd\u043d\ufffd\ufffd\u013b\ufffd\ufffd\u0138\ufffd\ufffd\u02ba\ufffd \r\n\t\t}\r\n\t\tans=(ans+tp*sm%p)%p;\r\n\t\tans=(ans+tp)%p;//\ufffd\u053c\ufffd \r\n\t}\r\ndeb\tprintf(\"cc=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long ab()//\u00f6\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\u07e3\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u01f6\ufffd\ufffd\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\u02ba\ufffd \r\n{\r\n\tlong long ans=0;\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tans=(ans+deg[i]*inv2(2)%p+(m-deg[i])*inv2(3)%p)%p;\r\n\t}\r\ndeb\tprintf(\"ab=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long ac()//\u00f6\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u01f6\ufffd\ufffd\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\u02ba\ufffd\r\n{\r\n\tlong long ans=0;\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tans=(ans+inv_sum[i])%p;\r\n\t\tans=(ans+(sum1-inv_sum[i]+p)%p*inv2(1)%p)%p; \r\n\t}\r\ndeb\tprintf(\"ac=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nlong long bc()//\u00f6\ufffd\ufffd\u04bb\ufffd\ufffd\ufffd\u07fa\ufffd\u04bb\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u01f6\ufffd\ufffd\ufffd\ufffd\u06b5\u0138\ufffd\ufffd\ufffd \r\n{\r\n\tlong long ans=0,tp=inv2(2);\r\n\tfor(int i=1;i<=cnt;i++)\r\n\t{\r\n\t\tlong long deg_sum=0;\r\n\t\tfor(auto j:var[i])\r\n\t\t\tdeg_sum+=deg[j];\r\n\t\tdeg_sum-=var[i].size()*2;\r\n\t\tans=(ans+inv2(var[i].size())*var[i].size()%p)%p;//\ufffd\ufffd\ufffd\u03f5\u0135\ufffd\r\n\t\tans=(ans+inv2(var[i].size())*deg_sum%p*inv2(1)%p)%p;\r\n\t\tans=(ans+inv2(var[i].size())*(m-deg_sum-var[i].size())%p*inv2(2)%p)%p; \r\n\t}\r\ndeb\tprintf(\"bc=%lld\\n\",ans);\r\n\treturn ans;\r\n}\r\nint main()\r\n{\r\n\tread(n,m);\r\n\tfor(int i=1,x,y;i<=m;i++)\r\n\t\tread(x,y),add(x,y),add(y,x),deg[x]++,deg[y]++,edge[i]=make_pair(x,y);\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tif(!deep[i])\r\n\t\t\tdfs(i);\r\ndeb\tfor(int i=1;i<=cnt;i++,printf(\"\\n\"))\r\n\t\tfor(auto j:edg[i])\r\n\t\t\tprintf(\"%d \",j);\r\ndeb\tfor(int i=1;i<=m;i++)printf(\"%d belong to %d\\n\",i,belong[i]);\r\n\tfor(int i=1;i<=cnt;i++)\r\n\t{\r\n\t\tsum1=(sum1+inv2(var[i].size()))%p;\r\n\t\tfor(auto j:var[i])\r\n\t\t\tinv_sum[j]=(inv_sum[j]+inv2(var[i].size()))%p;\r\n\t\tfor(auto k:var[i])\r\n\t\tfor(int j=head[i];j;j=ne[j])\r\n\t\t\tedg_inv_sum[turn(j)]=(edg_inv_sum[turn(j)]+inv2(var[i].size()))%p;\r\n\t}\r\ndeb\tfor(int i=1;i<=m;i++)\r\n\t\tprintf(\"edg_inv_sum %d = %lld\\n\",i,edg_inv_sum[i]);\r\n\tprintf(\"%lld\\n\",((aa()+bb()+cc())%p-2ll*(ab()+bc()-ac()+p)%p+p-E()*E()%p+p)%p);\r\n\treturn 0;\r\n}\r\n\r\n"
}