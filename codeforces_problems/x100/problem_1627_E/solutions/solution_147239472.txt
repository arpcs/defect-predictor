{
    "id": 147239472,
    "contestId": 1627,
    "creationTimeSeconds": 1645512455,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 1627,
        "index": "E",
        "name": "Not Escaping",
        "type": "PROGRAMMING",
        "points": 2000.0,
        "rating": 2200,
        "tags": [
            "data structures",
            "dp",
            "implementation",
            "shortest paths",
            "two pointers"
        ]
    },
    "author": {
        "contestId": 1627,
        "members": [
            {
                "handle": "raidencode"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1642257300
    },
    "programmingLanguage": "GNU C++14",
    "verdict": "WRONG_ANSWER",
    "testset": "TESTS",
    "passedTestCount": 1,
    "timeConsumedMillis": 171,
    "memoryConsumedBytes": 15769600,
    "source": "#include<iostream>\r\n#include<vector>\r\n#include<map>\r\n#include<algorithm>\r\n#define int long long\r\n\r\nusing namespace std;\r\n\r\nconst int N=100000;\r\nconst int INF=1e18;\r\n\r\nint readInt ()\r\n{\r\n    bool minus = false;\r\n    int result = 0;\r\n    char ch;\r\n    ch = getchar();\r\n    while (true)\r\n    {\r\n        if (ch == '-') break;\r\n        if (ch >= '0' && ch <= '9') break;\r\n        ch = getchar();\r\n    }\r\n    if (ch == '-') minus = true;\r\n    else result = ch-'0';\r\n    while (true)\r\n    {\r\n        ch = getchar();\r\n        if (ch < '0' || ch > '9') break;\r\n        result = result*10 + (ch - '0');\r\n    }\r\n    if (minus)\r\n        return -result;\r\n    else\r\n        return result;\r\n}\r\nint t[4 * N + 1], col[4 * N + 1];\r\nint f[N+1];\r\nvoid pull(int v, int tl, int tr)\r\n{\r\n    t[v] = min(INF,max(t[2 * v] + col[2 * v], t[2 * v + 1] + col[2 * v + 1]));\r\n    t[v]=max(-INF,t[v]);\r\n}\r\nvoid push(int v)\r\n{\r\n    col[2 * v] += col[v];\r\n    col[2 * v + 1] += col[v];\r\n    col[v] = 0;\r\n}\r\nvoid build(int v, int tl, int tr)\r\n{\r\n    if (tl == tr) {\r\n        t[v] = f[tl];\r\n        col[v]=0;\r\n        return;\r\n    }\r\n    int tm = (tl + tr) >> 1;\r\n    build(2 * v, tl, tm);\r\n    build(2 * v + 1, tm + 1, tr);\r\n    pull(v, tl, tr);\r\n}\r\nvoid add(int v, int tl, int tr, int L, int R, int x)\r\n{\r\n    if (tl == L && tr == R) {\r\n        col[v] += x;\r\n        return;\r\n    }\r\n    push(v);\r\n    int tm = (tl + tr) >> 1;\r\n    if (R <= tm) {\r\n        add(2 * v, tl, tm, L, R, x);\r\n    }\r\n    else if (L > tm) {\r\n        add(2 * v + 1, tm + 1, tr, L, R, x);\r\n    }\r\n    else {\r\n        add(2 * v, tl, tm, L, tm, x);\r\n        add(2 * v + 1, tm + 1, tr, tm + 1, R, x);\r\n    }\r\n    pull(v, tl, tr);\r\n}\r\nint getMax(int v, int tl, int tr, int L, int R)\r\n{\r\n//    cout<<v<<endl;\r\n    if (tl == L && tr == R) {\r\n        return t[v] + col[v];\r\n    }\r\n    push(v);\r\n    int tm = (tl + tr) >> 1;\r\n    int ans = 0;\r\n    if (R <= tm) {\r\n        ans = getMax(2 * v, tl, tm, L, R);\r\n    }\r\n    else if (L > tm) {\r\n        ans = getMax(2 * v + 1, tm + 1, tr, L, R);\r\n    }\r\n    else {\r\n        ans = max(getMax(2 * v, tl, tm, L, tm), getMax(2 * v + 1, tm + 1, tr, tm + 1, R));\r\n    }\r\n    pull(v, tl, tr);\r\n    return ans;\r\n}\r\nvector<int>o1[N+1];\r\nvector<int>o2[N+1];\r\nvector<int>p[N+1];\r\nint a[N+1];\r\nint b[N+1];\r\nint c[N+1];\r\nint d[N+1];\r\nint h[N+1];\r\n\r\nint x[N+1];\r\n\r\nmap<pair<int,int>,int>mp;\r\n\r\nvoid ii(int id)\r\n{\r\n    int sz=o2[id].size();\r\n    for(int i=1;i<=sz;i++){\r\n        col[i]=0;\r\n        int re=o2[id][i-1];\r\n        int x=c[re];\r\n        int y=d[re];\r\n        f[i]=mp[make_pair(x,y)];\r\n    }\r\n\r\n    build(1,1,sz);\r\n}\r\n\r\nmain()\r\n{\r\n    int q=readInt();\r\n\r\n    while(q--){\r\n        int n=readInt();\r\n        int m=readInt();\r\n        int k=readInt();\r\n        mp.clear();\r\n\r\n        for(int i=1;i<=n;i++){\r\n            o1[i].clear();\r\n            o2[i].clear();\r\n        }\r\n\r\n\r\n        for(int i=1;i<=n;i++){\r\n            x[i]=readInt();\r\n        }\r\n\r\n        for(int i=1;i<=k;i++){\r\n            a[i]=readInt();\r\n            b[i]=readInt();\r\n            c[i]=readInt();\r\n            d[i]=readInt();\r\n            h[i]=readInt();\r\n\r\n            o1[a[i]].push_back(i);\r\n            o2[c[i]].push_back(i);\r\n\r\n            mp[make_pair(c[i],d[i])]=-INF;\r\n        }\r\n//        continue;\r\n\r\n            a[k+1]=1;\r\n            b[k+1]=1;\r\n            c[k+1]=1;\r\n            d[k+1]=1;\r\n            h[k+1]=0;\r\n\r\n            a[k+2]=n;\r\n            b[k+2]=m;\r\n            c[k+2]=n;\r\n            d[k+2]=m;\r\n            h[k+2]=0;\r\n\r\n            o1[n].push_back(k+2);\r\n//            o1[n].push_back(k+2);\r\n\r\n            o2[1].push_back(k+1);\r\n//            o2[n].push_back(k+2);\r\n\r\n        mp[make_pair(1,1)]=0;\r\n        mp[make_pair(n,m)]=-INF;\r\n\r\n        for(int i=1;i<=n;i++){\r\n            if(o2[i].empty()){\r\n                continue;\r\n            }\r\n//            cout<<\"! \"<<i<<endl;\r\n\r\n            int sz1=o1[i].size();\r\n            int sz2=o2[i].size();\r\n\r\n            sort(o1[i].begin(),o1[i].end(),[](int ii,int jj){\r\n                    return b[ii]<b[jj];\r\n                 });\r\n\r\n            sort(o2[i].begin(),o2[i].end(),[](int ii,int jj){\r\n                    return d[ii]<d[jj];\r\n                 });\r\n            ii(i);\r\n//            continue;\r\n\r\n            int i1=sz1-1;\r\n            int i2=sz2-1;\r\n            int last=d[o2[i].back()];\r\n            int diff=0;\r\n\r\n            for(int j=sz1-1;j>=0;j--){\r\n                while(i2>0&&d[o2[i][i2-1]]>b[o1[i][j]]){\r\n                    i2--;\r\n                }\r\n                if(last>=d[o2[i][i2]]){\r\n                    diff=d[o2[i][i2]]-last;\r\n                    if(i2+2<=sz2){\r\n                        add(1,1,sz2,i2+2,sz2,diff*x[i]);\r\n                    }\r\n                    last=d[o2[i][i2]];\r\n                }\r\n\r\n                int mn=min(b[o1[i][j]],d[o2[i][i2]]);\r\n                if(mn<=last){\r\n                    diff=mn-last;\r\n                    if(i2+1<=sz2){\r\n                        add(1,1,sz2,i2+1,sz2,diff*x[i]);\r\n                    }\r\n                    if(mn==b[o1[i][j]]){\r\n                        int gg=getMax(1,1,sz2,i2+1,sz2);\r\n                        if(gg>-INF){\r\n                            mp[make_pair(c[o1[i][j]],d[o1[i][j]])]=max(mp[make_pair(c[o1[i][j]],d[o1[i][j]])],gg+h[o1[i][j]]);\r\n                        }\r\n                    }\r\n                    last=mn;\r\n                }\r\n\r\n            }\r\n\r\n            ii(i);\r\n            i1=0;\r\n            i2=0;\r\n            last=d[o2[i][0]];\r\n\r\n            for(int j=0;j<sz1;j++){\r\n                while(i2<sz2-1&&d[o2[i][i2+1]]<b[o1[i][j]]){\r\n                    i2++;\r\n                }\r\n                if(last<=d[o2[i][i2]]){\r\n                    diff=last-d[o2[i][i2]];\r\n                    if(i2>=1){\r\n                        add(1,1,sz2,1,i2,diff*x[i]);\r\n                    }\r\n                    last=d[o2[i][i2]];\r\n                }\r\n\r\n                int mx=max(b[o1[i][j]],d[o2[i][i2]]);\r\n                if(last<=mx){\r\n                    diff=last-mx;\r\n                    add(1,1,sz2,1,i2+1,diff*x[i]);\r\n    //                    cout<<i2+1<<\" || \"<<abs(d[o2[i][i2]]-b[o1[i][j]])<<\" \"<<x[i]<<endl;\r\n    //                    cout<<sz2<<\" - \"<<i2+1<<\" \"<<a[o1[i][j]]<<\" \"<<b[o1[i][j]]<<\" \"<<c[o1[i][j]]<<\" \"<<d[o1[i][j]]<<\" \"<<gg<<endl;\r\n    //                    int gg=0;\r\n\r\n                    if(mx==b[o1[i][j]]){\r\n                        int gg=getMax(1,1,sz2,1,i2+1);\r\n//                        cout<<\"? \"<<i<<\" \"<<d[o2[i][i2]]<<\" \"<<b[o1[i][j]]<<\" \"<<last<<\" \"<<mx<<\" \"<<gg<<endl;\r\n                        if(gg>-INF){\r\n                            mp[make_pair(c[o1[i][j]],d[o1[i][j]])]=max(mp[make_pair(c[o1[i][j]],d[o1[i][j]])],gg+h[o1[i][j]]);\r\n                        }\r\n                    }\r\n                    last=mx;\r\n                }\r\n\r\n            }\r\n        }\r\n        int res=mp[make_pair(n,m)];\r\n\r\n        if(res==-INF){\r\n            puts(\"NO ESCAPE\");\r\n        }else{\r\n            cout<<-res<<endl;\r\n        }\r\n\r\n//        for(map<pair<int,int>,int>::iterator it=mp.begin();it!=mp.end();it++){\r\n//            cout<<(*it).first.first<<\" \"<<(*it).first.second<<\" = \"<<(*it).second<<endl;\r\n//        }\r\n\r\n//        cout<<mp[make_pair(n,m)]<<endl;\r\n//        system(\"pause\");\r\n    }\r\n}\r\n\r\n"
}