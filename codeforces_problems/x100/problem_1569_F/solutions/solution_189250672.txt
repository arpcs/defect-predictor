{
    "id": 189250672,
    "contestId": 1569,
    "creationTimeSeconds": 1673724020,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 1569,
        "index": "F",
        "name": "Palindromic Hamiltonian Path",
        "type": "PROGRAMMING",
        "rating": 3000,
        "tags": [
            "brute force",
            "dfs and similar",
            "dp",
            "graphs",
            "hashing"
        ]
    },
    "author": {
        "contestId": 1569,
        "members": [
            {
                "handle": "Challenge_Recorder"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1631111700
    },
    "programmingLanguage": "GNU C++20 (64)",
    "verdict": "OK",
    "testset": "TESTS",
    "passedTestCount": 122,
    "timeConsumedMillis": 701,
    "memoryConsumedBytes": 307200,
    "source": "#include <bits/stdc++.h>\r\n#define int long long\r\nusing namespace std;\r\nint e[15][15],W[15];\r\nint a[15],n,m,k,C;\r\nint cnt=0,ans=0;\r\n__int128 ok[15000];\r\nvoid dfs(int nw)\r\n{\r\n\tint c=0,mx=0;\r\n\tfor(int i=1;i<=n;i++) c+=!!a[i];\r\n\tif(c==n-1)\r\n\t{\r\n\t\tif(n%2==0) return ;\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tif(!a[i]) a[i]=nw;\r\n\t\tdfs(nw+1);\r\n\t\treturn ;\r\n\t}\r\n\tif(c==n)\r\n\t{\r\n\t\t++cnt;\r\n\t\t__int128 qwq=0;\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tfor(int j=i+1;j<=n;j++)\r\n\t\t\t\tqwq*=2,qwq+=(a[i]==a[j]);\r\n\t\tint flag=0;\r\n\t\tfor(int i=1;i<=C;i++)\r\n\t\t{\r\n\t\t\tif((qwq&ok[i])==ok[i])\r\n\t\t\t{\r\n\t\t\t\tflag=1;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(flag==1)\r\n\t\t\tans+=W[nw-1];\r\n\t\treturn ;\r\n\t}\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tif(!a[i])\r\n\t\t{\r\n\t\t\ta[i]=nw;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tint S=0;\r\n\tfor(int i=1;i<=n;i++)\r\n\t\tif(a[i]) S|=(1<<i-1);\r\n\tint k=(S^(1<<n)-1);\r\n\tfor(int s=k;s;s=(s-1&k))\r\n\t{\r\n\t\tif(!s) continue;\r\n\t\tif(!__builtin_parity(s)) continue;\r\n\t\tfor(int j=0;j<n;j++)\r\n\t\t\tif(s&(1<<j)) a[j+1]=nw;\r\n\t\tdfs(nw+1);\r\n\t\tfor(int j=0;j<n;j++)\r\n\t\t\tif(s&(1<<j)) a[j+1]=0;\r\n\t}\r\n\tfor(int j=1;j<=n;j++) if(a[j]==nw) a[j]=0;\r\n}\r\nint p[15];\r\nbool dp[64][6];\r\nsigned main()\r\n{\r\n\tios::sync_with_stdio(false);\r\n\tcin.tie(0);\r\n\tcin >> n >> m >> k;\r\n\tfor(int i=1;i<=m;i++)\r\n\t{\r\n\t\tint u,v;\r\n\t\tcin >> u >> v;\r\n\t\te[u][v]=e[v][u]=1;\r\n\t}\r\n\tfor(int i=1;i<=n;i++)\r\n\t{\r\n\t\tW[i]=1;\r\n\t\tfor(int j=k;j>=k-i+1;j--) W[i]*=j;\r\n\t}\r\n\tfor(int i=1;i<=n;i++) p[i]=(i+1)/2;\r\n\tdo\r\n\t{\r\n\t\tint A[15]={},qwqwq[15]={};\r\n\t\tint mx=0,flag=1;\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t{\r\n\t\t\tif(p[i]>mx+1) flag=0;\r\n\t\t\tmx=max(mx,p[i]);\r\n\t\t}\r\n\t\tif(!flag) continue;\r\n//\t\tfor(int i=1;i<=n;i++) cout << p[i] << \" \";\r\n//\t\tcout << \"\\n\";\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tfor(int j=1;j<=n;j++)\r\n\t\t\t\tif(i!=j&&p[i]==p[j]) A[i]=j;\r\n\t\tvector<pair<int,int> > v;\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tif(A[i]>i) v.push_back({i,A[i]});\r\n\t\tmemset(dp,0,sizeof dp);\r\n\t\tfor(int i=0;i<n/2;i++) dp[(1<<i)][i]=1;\r\n\t\tfor(int s=0;s<(1<<n/2);s++)\r\n\t\t{\r\n\t\t\tfor(int i=0;i<n/2;i++)\r\n\t\t\t{\r\n\t\t\t\tif(dp[s][i]) for(int j=0;j<n/2;j++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif((s&(1<<j))) continue;\r\n\t\t\t\t\tif(e[v[i].first][v[j].first]&&e[v[i].second][v[j].second]||e[v[i].second][v[j].first]&&e[v[i].first][v[j].second])\r\n\t\t\t\t\t\tdp[s|(1<<j)][j]=1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t__int128 qwq=0;\r\n\t\tfor(int i=1;i<=n;i++)\r\n\t\t\tfor(int j=i+1;j<=n;j++)\r\n\t\t\t\tqwq*=2,qwq+=(A[i]==j||A[j]==i);\r\n\t\tfor(int i=0;i<n/2;i++)\r\n\t\t{\r\n\t\t\tif(e[v[i].first][v[i].second]&&dp[(1<<n/2)-1][i])\r\n\t\t\t{\r\n\t\t\t\tok[++C]=qwq;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}while(next_permutation(p+1,p+n+1));\r\n\tdfs(1);\r\n\tcout << ans;\r\n//\tcout << cnt << \"\\n\";\r\n\treturn 0;\r\n}"
}