{
    "id": 180306231,
    "contestId": 1750,
    "creationTimeSeconds": 1668085794,
    "relativeTimeSeconds": 2147483647,
    "problem": {
        "contestId": 1750,
        "index": "E",
        "name": "Bracket Cost",
        "type": "PROGRAMMING",
        "points": 2250.0,
        "rating": 2400,
        "tags": [
            "binary search",
            "data structures",
            "divide and conquer",
            "dp",
            "greedy",
            "strings"
        ]
    },
    "author": {
        "contestId": 1750,
        "members": [
            {
                "handle": "_WhiteWine_"
            }
        ],
        "participantType": "PRACTICE",
        "ghost": false,
        "startTimeSeconds": 1667745300
    },
    "programmingLanguage": "GNU C++20 (64)",
    "verdict": "WRONG_ANSWER",
    "testset": "TESTS",
    "passedTestCount": 2,
    "timeConsumedMillis": 46,
    "memoryConsumedBytes": 5734400,
    "source": "/////////////////////include/////////////////////\r\n//#include <bits/stdc++.h>\r\n#define _CRT_SECURE_NO_WARNINGS\r\n#include <iostream>\r\n#include <string>\r\n#include <algorithm>\r\n#include <cmath>\r\n#include <cstring>\r\n#include <cassert>\r\n#include <set>\r\n#include <map>\r\n#include <unordered_map>\r\n#include <vector>\r\n#include <stack>\r\n#include <queue>\r\n#include <iomanip>\r\n#include <bitset>\r\n#include <stdio.h>\r\n#include <climits>\r\n#include <numeric>\r\nusing namespace std;\r\n//#include <ext/pb_ds/assoc_container.hpp>\r\n//#include <ext/pb_ds/tree_policy.hpp>\r\n//using namespace __gnu_pbds;\r\n//template <typename T>\r\n//using ordered_set = tree <T, null_type, less<T>, rb_tree_tag, tree_order_statistics_node_update>;\r\n/////////////////////define/////////////////////\r\n#define ci(x) if(x) cout << \"YES\" << '\\n'; else cout << \"NO\" << '\\n';\r\n#define cii(x) if(check(x))\r\n#define MOD 1000000007\r\n#define MOD2 998244353\r\n#define oo 1e9\r\n#define ool 1e18L\r\n#define pii pair<int, int>\r\n#define pll pair<long long, long long>\r\n#define mii map<int, int>\r\n#define vi vector<int>\r\n#define vpi vector<pair<int, int>>\r\n#define vll vector <ll>\r\n#define ff first\r\n#define ss second\r\n#define mp make_pair\r\n#define ll long long\r\n#define ld long double\r\n#define pb push_back\r\n#define eb emplace_back\r\n#define pob pop_back\r\n#define lb lower_bound\r\n#define ub upper_bound\r\n#define bs binary_search\r\n#define sz(x) (int((x).size()))\r\n#define all(x) (x).begin(), (x).end()\r\n#define alll(x) (x), (x) + n\r\n#define clr(x) (x).clear();\r\n#define fri(x) for(int i = 0; i < x; ++i)\r\n#define frj(x) for(int j = 0; j < x; ++j)\r\n#define frp(x) for(int p = 0; p < x; ++p)\r\n#define frr(a, b) for(int i = a; i < b; ++i)\r\n#define frrj(a, b) for(int j = a; j < b; ++j)\r\n#define fra(x) for(int i = 0; i < x; ++i) cin >> a[i];\r\n#define frb(x) for(int i = 0; i < x; ++i) cin >> b[i];\r\n#define frs(x) for(auto it = x.begin(); it != x.end(); ++it)\r\n#define fr(x) for(auto it : x) //el\r\n#define fastio ios_base::sync_with_stdio(false); cin.tie(0);\r\n#define dbg(x) cerr << #x << \": \" << x << endl;\r\n#define ce(x) cout << x << endl;\r\n#define uniq(x) x.resize(unique(all(x)) - x.begin()); //make all one after sorting\r\n#define blt __builtin_popcount\r\n/////////////////////print array, vector, deque, set, multiset, pair, map /////////////////////\r\nvoid print(long long t) {cerr << t;}\r\nvoid print(int t) {cerr << t;}\r\nvoid print(string t) {cerr << t;}\r\nvoid print(char t) {cerr << t;}\r\nvoid print(double t) {cerr << t;}\r\nvoid print(long double t) {cerr << t;}\r\nvoid print(unsigned long long t) {cerr << t;}\r\ntemplate <class T, class V> void print(pair <T, V> p) {cerr << \"{\"; print(p.first); cerr << \",\"; print(p.second); cerr << \"}\";}\r\ntemplate <class T, class V> void print(T v[],V n) {cerr << \"[\"; for(int i = 0; i < n; i++) {print(v[i]); cerr << \" \"; } cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(vector <T> v) {cerr << \"[ \"; for (T i : v) {print(i); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(set <T> v) {cerr << \"[ \"; for (T i : v) {print(i); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(multiset <T> v) {cerr << \"[ \"; for (T i : v) {print(i); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(stack <T> v) {cerr << \"[ \"; stack<T> s = v; while(s.size()) {int i = s.top(); print(i); s.pop(); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(queue <T> v) {cerr << \"[ \"; queue<T> s = v; while(s.size()) {int i = s.front(); print(i); s.pop(); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T> void print(deque <T> v) {cerr << \"[ \"; deque<T> s = v; while(s.size()) {int i = s.front(); print(i); s.pop_front(); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T, class V> void print(map <T, V> v) {cerr << \"[ \"; for (auto i : v) {print(i); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\ntemplate <class T, class V> void print(unordered_map <T, V> v) {cerr << \"[ \"; for (auto i : v) {print(i); cerr << \" \";} cerr << \"]\"; cout << endl;}\r\n/////////////////////code/////////////////////\r\nll pref[200005]; int l[200005], r[200005];\r\n\r\nvoid solve() {\r\n    int n; string s; ll ans = 0;\r\n    cin >> n >> s;\r\n    vi v; v.pb(0);\r\n    fri(n) {\r\n        if(s[i] == '(') pref[1 + i] = pref[i] + 1;\r\n        else pref[1 + i] = pref[i] - 1;\r\n        v.pb(pref[1 + i]);\r\n    }\r\n    //1in gorcoxutyuny mi ( a vercnum vercnum u tanuma dzax\r\n    //2rd gorc depqum ( avelacnelis amenaskzbum kavelacnenq u bolor pref neri arjeqy 1ov kavelana isk ) avelacnelis uxxaki balansavorvuma ban chi poxvum\r\n    //1.ete )nery avel en(pref[n] < 0), ditarkenq minprefy(0,..,n). inqy hastat <= pakagceri tarberutyun minus nshanov, uremn karanq uxxaki -minprefy vercnenq vorpes patasxan vortev ((( nery demy shareluc heto evs vorosh qayl karoxa mna amen qayli amenaaj ( y karelia berel dnel amenadzaxum u tenc ayd kety u dranic dzax bolor prefnery(min n el hety) karelia +1 anel so\r\n    //2.ete (nery avel en(pref[n] > 0), pref[n] i chapov verjic ) kavelacnenq vory pref nerum ban chi poxi so \r\n    //1.ans = -minpref, 2.ans = pref[n]-minpref => ans = max(0, pref[n]) - minpref => l, r i hamar ans = max(0, pref[r] - pref[l - 1]) - (minpref(l...r) - pref[l - 1]) = \r\n    //=max(pref[l - 1], pref[r]) - minpref(l-1...r) (ete bacasakan pref ner chlinen, 0 kgumarvi (l-1 y dra hamar enq drel dra arjeqy bacardzak 0 a))\r\n    sort(all(v));\r\n    frr(1, n + 1) ans += v[i] * i; //fixenq r: nayenq qani ban ka voric inqy meca u gumarenq ed angam\r\n    //vorpes min vercnenq amenaajiny (ete mi qani hat en) => dzaxic gtnel 1in <y, isk ajic 1in <=y (ete iranic <=ka arden kangnum enq)\r\n    stack<pii> st;\r\n    st.push({pref[0], 0});\r\n    fill(l, l + n + 1, -1);\r\n    fill(r, r + n + 1, n + 1);\r\n    frr(1, n + 1) {\r\n        pii p = st.top();\r\n        while(p.ff >= pref[i]) {\r\n            r[p.ss] = i; //iranic aj 1in <=y\r\n            st.pop();\r\n            if(st.size()) p = st.top();\r\n            else break;\r\n        }\r\n        if(st.size()) {\r\n            p = st.top();\r\n            l[i] = p.ss; //iranic dzax 1in <y\r\n        }\r\n        st.push({pref[i], i});\r\n    }\r\n    // dbg(ans) print(pref, n + 1); print(l, n + 1); print(r, n + 1);\r\n    fri(n + 1) \r\n        ans -= pref[i] * ((r[i] - i) * (i - l[i]) - 1); // -1 aysinqn baci 1 erkarutyan mijakayqic qani vor ayn chi karox linel [l-1,r] mij\r\n    cout << ans << endl;\r\n}\r\nint main() {\r\n    fastio;\r\n    int t = 1;\r\n    cin >> t;\r\n    while(t--) {\r\n        solve();\r\n    }\r\n    return 0;\r\n}\r\n\r\n//\t           \u2665 \u2665 \u2665  \u2665  \u2665    \u2665   \u2665    \u2665\r\n//\t           \u2665      \u2665  \u2665     \u2665 \u2665    \u2665 \u2665\r\n//\t           \u2665 \u2665 \u2665  \u2665  \u2665      \u2665    \u2665   \u2665\r\n//\t           \u2665      \u2665  \u2665      \u2665   \u2665 \u2665 \u2665 \u2665\r\n//\t           \u2665      \u2665  \u2665 \u2665 \u2665  \u2665  \u2665       \u2665\r\n//\r\n//        God loves Fil, Fil accepts God's will\r\n"
}